@model IEnumerable<MealPlanner.Models.Models.ShoppingItem>

<h2>Grocery List</h2>
<hr />
<table class="table">
    <thead>
        <tr>
            <th></th>
            <th>
                @Html.DisplayNameFor(model => model.IngredientName)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr id="row@(item.Id)">
                <td>
                    <div style="padding: 8px;">
                        <a href="javascript:drillIntoItem(@item.Id)"><i class="glyphicon glyphicon-plus"></i></a>
                    </div>
                </td>
                <td>
                    <div style="padding: 8px;">
                        @item.IngredientName (@item.Quantity @item.Unit)
                    </div>
                </td>
                <td>
                    <div class="btn-group" style="float:right; padding: 8px;">
                        <a href="javascript:removeItem(@item.Id)" class="btn btn-sm btn-danger">
                            <i class="glyphicon glyphicon-remove"></i>
                        </a>
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>

<a href="javascript:undoRemove()" id="undoBtn" class="btn btn-warning" style="width: 100%; display:none; position:fixed; bottom: 0; right: 0;">Undo</a>

<style>
    td {
        padding: 0 !important;
    }
</style>

<script>
    var removed = [];

    function removeItem(id) {
        removed.push(id);
        $('#row' + id).children('td').children('div').slideUp(200);
        $('#undoBtn').slideDown(200);
    }

    function undoRemove() {
        $('#row' + removed.pop()).children('td').children('div').slideDown(200);
        if (removed.length == 0) {
            $('#undoBtn').slideUp(200);
        }
    }

    $('tr').on('click', function () {
        if ($(this).hasClass('selected')) {
            $(this).find('td').css('background-color', 'transparent');
            $(this).find('td').css('color', '#2c3e50');
            $(this).removeClass('selected');
        }
        else {
            $(this).find('td').css('background-color', '#2c3e50');
            $(this).find('td').css('color', 'white');
            $(this).addClass('selected');
        }
    })

    function drillIntoItem(id) {
        if ($('#drillIn' + id).length) {
            $('#drillIn' + id).remove();
        }
        else {
            $('#row' + id).after('<tr><td colspan="3" id="drillIn' + id + '"></td></tr>');
            $('#drillIn' + id).load('/ShoppingList/RecipeDrillIn/' + id);
        }
    }
</script>